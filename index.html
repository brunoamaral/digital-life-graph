<html>
  <head>
    <script src="./bower_components/jquery/jquery.js"></script>
    <script src="./sigma.min.js"></script>

    <style type="text/css">
      #sigma {
        display: block;
        width: 100%;
        height: 600px;
        background-color: #222222;
      }
    </style>
  </head>
  <body>
    <div id="sigma"></div>
    <script type="text/javascript">
      digital_life_visualization = {
        //=====================================================
        // Define your data here

        // Services you user (name, colour)
        services: [
          ['Facebook', '#364A90'], 
          ['Twitter','#1D80BB'], 
          ['Flickr','#F40075'], 
          ['Instagram','#A7865D'], 
          ['G+','#BB2A1A'], 
          ['EyeEm','#ECEAEA'], 
          ['Tumblr','#2A405F'], 
          ['Vimeo','#25A3E2'], 
          ['Youtube','#B6201D'], 
          ['Blog','#B93513'], 
          ['Pocket','#EA2443'], 
          ['Pinboard','#315AFF'], 
          ['Instapaper','#EFEFED'], 
          ['Last.fm','#BC0C16'], 
          ['Spotify','#80B600'], 
          ['LinkedIn','#216FB3'], 
          ['Foursquare','#1E7FC4'],
          ['Netflix','#A40000'],
          ['Flipboard','#8A0000']
        ],

        // Devices you use to feed or access the services
        devices: [
          ['phone','#ECEAEA'],
          ['dslr','#ECEAEA'],
          ['kindle','#ECEAEA'],
          ['tablet','#ECEAEA'],
          ['computer','#ECEAEA'],
          ['xbox','#ECEAEA'],
        ],

        // Defines relationships between services
        service_edges: [
          ['instagram','facebook'],
          ['eyeem', 'facebook'],
          ['blog', 'facebook'],
          ['flickr', 'facebook'],
          ['spotify','last.fm'],
          ['spotify','facebook'],
          ['netflix', 'facebook'],
          ['facebook', 'flipboard'],
          ['twitter', 'flipboard'],
          ['g+', 'flipboard'],
          ['flipboard', 'pocket'],
          ['flipboard', 'instapaper'],
          ['vimeo','tumblr'],
          ['youtube','tumblr'],
          ['flickr','tumblr'],
          ['instagram', 'tumblr'],
          ['instapaper', 'blog'],
          ['instagram', 'foursquare'],
          ['eyeem','foursquare'],
          ['instagram','twitter'],
          ['eyeem','twitter'],
          ['blog','twitter'],
          ['tumblr','twitter'],
          ['tumblr','tumblr'],
          ['last.fm', 'twitter'],
        ],

        //Defines relationships were the device feeds the service
        device_service_edges: [
          ['dslr','flickr'],
          ['dslr','facebook'],
          ['dslr','g+'],
          ['phone','instagram'],
          ['phone','eyeem'],
          ['phone','facebook'],
          ['phone','twitter'],
          ['phone','youtube'],
          ['phone','foursquare'],
          ['computer','blog'],
          ['tablet', 'instapaper'],
          ['tablet', 'pocket']
        ],

        // Defines relationships where the service is consumed on a device
        service_device_edges: [
          ['instagram','phone'],
          ['eyeem','phone'],
          ['facebook','phone'],
          ['youtube','phone'],
          ['spotify','phone'],
          ['instapaper','kindle'],
          ['flipboard','tablet'],
          ['g+','tablet'],
          ['netflix','tablet'],
          ['tumblr','tablet'],
          ['netflix','xbox'],
          ['facebook','tablet'],
          ['facebook','computer'],
          ['flickr','computer'],
          ['twitter','computer'],
          ['netflix','computer'],
          ['linkedin','computer'],
          ['spotify','computer'],
        ],

        // Initialise the graphÃŸ
        init: function() {
          var sigInst = sigma.init(document.getElementById('sigma')).drawingProperties({
            defaultLabelColor: '#fff',
            defaultLabelSize: 14,
            defaultLabelBGColor: '#fff',
            defaultLabelHoverColor: '#000',
            labelThreshold: 1,
            defaultEdgeType: 'curve'
          }).graphProperties({
            minNodeSize: 0.5,
            maxNodeSize: 10,
            minEdgeSize: 1,
            maxEdgeSize: 1,
            sideMargin: 50
          }).mouseProperties({
            maxRatio: 32
          });

          // Calculate the frequency of all the nodes
          node_frequency = this.nodeFrequency( this.service_edges.concat( this.device_service_edges, this.service_device_edges ) )

          this.createNodes(sigInst, this.services, node_frequency,0,150 )
          this.createNodes(sigInst, this.devices, node_frequency , -400, 50 )

          $(this.service_edges.concat(this.service_device_edges)).each( function(idx) {
            sigInst.addEdge( this.join('_'), this[0], this[1], {arrow: 'target'} )
          })

          $(this.device_service_edges).each( function(idx) {
            sigInst.addEdge( this.join('_'), this[0], this[1], {arrow: 'target', type: 'line'} )
          })
         
          sigInst.draw();
        },
        nodeLabel: function (label) {
          return label ? label.toLowerCase() : ''
        },
        nodeFrequency: function(edges) {
          result = {}
          var _this = this
          $(edges).each( function(idx) {
            result[_this.nodeLabel(this[0])] = +result[_this.nodeLabel(this[0])] + 1 || 1
            result[_this.nodeLabel(this[1])] = +result[_this.nodeLabel(this[1])] + 1 || 1
          })

          return result
        },
        createNodes: function(sigma, list, frequency, x_offset, radius ) {
          frequency = frequency || {};
          x_offset = x_offset || 0;
          radius = radius || 200
          var _this = this

          list = list.filter( function(el) {
            return frequency[_this.nodeLabel(el[0])] > 0
          })

          console.log(list)

          $(list).each( function(idx) {
            sigma.addNode(_this.nodeLabel(this[0]), {
              label: this[0],
              color: this[1],
              x: (Math.sin( (Math.PI * 2) / list.length * idx) * radius) + x_offset,
              y: Math.cos( (Math.PI * 2) / list.length * idx) * radius,
              size: 1 + (frequency[_this.nodeLabel(this[0])] || 0 )
            })
          })
        }
      }
       
      if (document.addEventListener) {
        document.addEventListener("DOMContentLoaded", digital_life_visualization.init(), false);
      } else {
        window.onload = digital_life_visualization.init();
      }
    </script>
  </body>
</html>